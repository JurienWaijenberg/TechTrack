import{f as O,a as y,c as Ne,t as me}from"../chunks/DK0t8MAW.js";import{h as Z,a as wa,b as Sa,y as i,al as ya,r as $a,H as xa,s as qe,c as De,d as Ie,k as de,R as Ta,aj as Ca,j as He,l as Aa,e as Ra,ah as Je,am as Ma,i as Qe,an as Na,W as Be,a4 as Ye,f as ze,p as Da,ao as ge,ap as be,g as Ge,aq as Ee,ar as Ia,S as ba,as as Fa,ag as Ha,at as La,M as ka,K as Oa,au as Ve,Z as Ua,av as Wa,B as qa,aw as le,ax as Ba,ay as D,u as Ya,C as ie,F as Pa,az as Xa,J as b,G as $,I as S,D as B,a5 as Ja}from"../chunks/DpkMm3R6.js";import{s as I}from"../chunks/DqzjzzG8.js";import{i as Q}from"../chunks/RrAb_RiY.js";import"../chunks/CIXG4OWF.js";function Pe(l,t){return t}function Qa(l,t,a){for(var c=l.items,d=[],p=t.length,u=0;u<p;u++)Fa(t[u].e,d,!0);var w=p>0&&d.length===0&&a!==null;if(w){var F=a.parentNode;Ha(F),F.append(a),c.clear(),z(l,t[0].prev,t[p-1].next)}La(d,()=>{for(var x=0;x<p;x++){var m=t[x];w||(c.delete(m.k),z(l,m.prev,m.next)),Ge(m.e,!w)}})}function Xe(l,t,a,c,d,p=null){var u=l,w={flags:t,items:new Map,first:null},F=(t&Ve)!==0;if(F){var x=l;u=Z?De(Oa(x)):x.appendChild(Qe())}Z&&wa();var m=null,A=!1,N=new Map,U=ya(()=>{var g=a();return Ma(g)?g:g==null?[]:Je(g)}),n,h;function f(){za(h,n,w,N,u,d,t,c,a),p!==null&&(n.length===0?m?ze(m):m=He(()=>p(u)):m!==null&&Da(m,()=>{m=null}))}Sa(()=>{h??=ka,n=i(U);var g=n.length;if(A&&g===0)return;A=g===0;let R=!1;if(Z){var H=$a(u)===xa;H!==(g===0)&&(u=qe(),De(u),Ie(!1),R=!0)}if(Z){for(var W=null,E,s=0;s<g;s++){if(de.nodeType===Ta&&de.data===Ca){u=de,R=!0,Ie(!1);break}var v=n[s],T=c(v,s);E=Le(de,w,W,null,v,T,s,d,t,a),w.items.set(T,E),W=E}g>0&&De(qe())}if(Z)g===0&&p&&(m=He(()=>p(u)));else if(Aa()){var j=new Set,ae=Ra;for(s=0;s<g;s+=1){v=n[s],T=c(v,s);var Y=w.items.get(T)??N.get(T);Y?(t&(Ee|ge))!==0&&Ze(Y,v,s,t):(E=Le(null,w,null,null,v,T,s,d,t,a,!0),N.set(T,E)),j.add(T)}for(const[L,K]of w.items)j.has(L)||ae.skipped_effects.add(K.e);ae.oncommit(f)}else f();R&&Ie(!0),i(U)}),Z&&(u=de)}function za(l,t,a,c,d,p,u,w,F){var x=(u&Wa)!==0,m=(u&(Ee|ge))!==0,A=t.length,N=a.items,U=a.first,n=U,h,f=null,g,R=[],H=[],W,E,s,v;if(x)for(v=0;v<A;v+=1)W=t[v],E=w(W,v),s=N.get(E),s!==void 0&&(s.a?.measure(),(g??=new Set).add(s));for(v=0;v<A;v+=1){if(W=t[v],E=w(W,v),s=N.get(E),s===void 0){var T=c.get(E);if(T!==void 0){c.delete(E),N.set(E,T);var j=f?f.next:n;z(a,f,T),z(a,T,j),Fe(T,j,d),f=T}else{var ae=n?n.e.nodes_start:d;f=Le(ae,a,f,f===null?a.first:f.next,W,E,v,p,u,F)}N.set(E,f),R=[],H=[],n=f.next;continue}if(m&&Ze(s,W,v,u),(s.e.f&be)!==0&&(ze(s.e),x&&(s.a?.unfix(),(g??=new Set).delete(s))),s!==n){if(h!==void 0&&h.has(s)){if(R.length<H.length){var Y=H[0],L;f=Y.prev;var K=R[0],ce=R[R.length-1];for(L=0;L<R.length;L+=1)Fe(R[L],Y,d);for(L=0;L<H.length;L+=1)h.delete(H[L]);z(a,K.prev,ce.next),z(a,f,K),z(a,ce,Y),n=Y,f=ce,v-=1,R=[],H=[]}else h.delete(s),Fe(s,n,d),z(a,s.prev,s.next),z(a,s,f===null?a.first:f.next),z(a,f,s),f=s;continue}for(R=[],H=[];n!==null&&n.k!==E;)(n.e.f&be)===0&&(h??=new Set).add(n),H.push(n),n=n.next;if(n===null)continue;s=n}R.push(s),f=s,n=s.next}if(n!==null||h!==void 0){for(var re=h===void 0?[]:Je(h);n!==null;)(n.e.f&be)===0&&re.push(n),n=n.next;var fe=re.length;if(fe>0){var we=(u&Ve)!==0&&A===0?d:null;if(x){for(v=0;v<fe;v+=1)re[v].a?.measure();for(v=0;v<fe;v+=1)re[v].a?.fix()}Qa(a,re,we)}}x&&Ua(()=>{if(g!==void 0)for(s of g)s.a?.apply()}),l.first=a.first&&a.first.e,l.last=f&&f.e;for(var Se of c.values())Ge(Se.e);c.clear()}function Ze(l,t,a,c){(c&Ee)!==0&&Ye(l.v,t),(c&ge)!==0?Ye(l.i,a):l.i=a}function Le(l,t,a,c,d,p,u,w,F,x,m){var A=(F&Ee)!==0,N=(F&Ia)===0,U=A?N?Na(d,!1,!1):Be(d):d,n=(F&ge)===0?u:Be(u),h={i:n,v:U,k:p,a:null,e:null,prev:a,next:c};try{if(l===null){var f=document.createDocumentFragment();f.append(l=Qe())}return h.e=He(()=>w(l,U,n,x),Z),h.e.prev=a&&a.e,h.e.next=c&&c.e,a===null?m||(t.first=h):(a.next=h,a.e.next=h.e),c!==null&&(c.prev=h,c.e.prev=h.e),h}finally{}}function Fe(l,t,a){for(var c=l.next?l.next.e.nodes_start:a,d=t?t.e.nodes_start:a,p=l.e.nodes_start;p!==null&&p!==c;){var u=ba(p);d.before(p),p=u}}function z(l,t,a){t===null?l.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}function Ga(l,t,a){var c=l==null?"":""+l;return c=c?c+" "+t:t,c===""?null:c}function Va(l,t,a,c,d,p){var u=l.__className;if(Z||u!==a||u===void 0){var w=Ga(a,c);(!Z||w!==l.getAttribute("class"))&&(w==null?l.removeAttribute("class"):l.className=w),l.__className=a}return p}var Za=O("<header></header>");function ja(l){var t=Za();y(l,t)}var Ka=O("<span> </span>"),er=O('<p class="state-message error svelte-1uha8ag"> </p>'),ar=O('<p class="state-message svelte-1uha8ag">Loading race sessions…</p>'),rr=O('<p class="state-message svelte-1uha8ag">No race sessions found.</p>'),sr=O('<br/> <small style="opacity: 0.6; font-size: 0.85rem;"> <br/> Console commands: <code>clearF1Cache()</code></small>',1),tr=O('<p class="svelte-1uha8ag"> </p>'),nr=O('<li class="session-result svelte-1uha8ag"><span class="position svelte-1uha8ag"> </span> <span class="driver svelte-1uha8ag"> </span> <span class="team svelte-1uha8ag"> </span> <span class="meta svelte-1uha8ag"><!> <!></span></li>'),or=O('<ul class="session-results svelte-1uha8ag"></ul>'),lr=O('<p class="state-message svelte-1uha8ag">No classification available yet.</p>'),ir=O('<article class="race-session svelte-1uha8ag"><header class="svelte-1uha8ag"><h3 class="svelte-1uha8ag"> </h3> <!></header> <div class="session-meta svelte-1uha8ag"><span> </span> <span> </span></div> <!></article>'),cr=O('<p class="state-message svelte-1uha8ag"> <!></p> <!>',1),fr=O('<!> <div class="page-container svelte-1uha8ag"><section class="race-sessions svelte-1uha8ag"><h2>2025 F1 Race Sessions <!></h2> <!></section></div>',1);function pr(l,t){qa(t,!0);const a="https://api.openf1.org/v1/sessions?year=2025&session_name=Race",c="https://api.openf1.org/v1/session_result?session_key=",d=5,p=3e3,u=2e3,w=1e4,F=3600*1e3,x="f1_cache_sessions_2025",m="f1_cache_session_result_";let A=le(Ba([])),N=le(!1),U=le(null),n=le(null),h=le(0),f=le(u);function g(e){try{const r=localStorage.getItem(e);if(!r)return null;const o=JSON.parse(r);return Date.now()-o.timestamp>o.ttl?(localStorage.removeItem(e),null):o.data}catch(r){return console.error(`Error reading cache for ${e}:`,r),null}}function R(e,r){try{const o={data:r,timestamp:Date.now(),ttl:F};localStorage.setItem(e,JSON.stringify(o))}catch(o){console.error(`Error writing cache for ${e}:`,o),o instanceof DOMException&&o.name==="QuotaExceededError"&&H()}}function H(){try{const e=[];for(let r=0;r<localStorage.length;r++){const o=localStorage.key(r);if(!(!o||!o.startsWith(x)&&!o.startsWith(m)))try{const C=localStorage.getItem(o);if(C){const _=JSON.parse(C);Date.now()-_.timestamp>_.ttl&&e.push(o)}}catch{e.push(o)}}e.forEach(r=>localStorage.removeItem(r)),e.length>0&&console.log(`Cleared ${e.length} expired cache entries`)}catch(e){console.error("Error clearing expired cache:",e)}}async function W(e){const r=`${m}${e}`;if(g(r)){console.log(`Session ${e} already cached`);return}console.log(`Manually fetching session ${e}...`);try{await E(2e3);const C=await s(e);C.length>0?console.log(`✓ Successfully cached session ${e} with ${C.length} results`):console.warn(`⚠ Session ${e} returned empty results`)}catch(C){console.error(`✗ Failed to prime cache for session ${e}:`,C)}}typeof window<"u"&&(window.clearF1Cache=()=>{const e=[];for(let r=0;r<localStorage.length;r++){const o=localStorage.key(r);o&&(o.startsWith(x)||o.startsWith(m))&&e.push(o)}e.forEach(r=>localStorage.removeItem(r)),console.log(`Cleared ${e.length} cache entries`),D(A,[],!0),v()},window.primeF1Cache=e=>W(e),window.primeF1CacheMultiple=async e=>{console.log(`Priming cache for ${e.length} sessions...`);for(const r of e)await W(r),await E(2e3);console.log("✓ Cache priming complete. Reload the page to see results.")});async function E(e){return new Promise(r=>setTimeout(r,e))}async function s(e,r=1){const o=`${m}${e}`,C=g(o);if(C)return console.log(`✓ Using cached session results for session ${e}`),C;try{const _=await fetch(`${c}${e}`);if(_.status===429){Xa(h);const se=_.headers.get("retry-after");let G;return se?G=Number(se)*1e3+500:(G=Math.min(p*Math.pow(2,r-1),3e4),G+=Math.random()*500),r<d?(console.warn(`⚠ 429 for session ${e} (attempt ${r}/${d}), waiting ${Math.round(G)}ms before retry...`),D(f,Math.min(i(f)*1.5,w),!0),await E(G),s(e,r+1)):(console.error(`✗ Max retries reached for session ${e}. Returning empty result.`),[])}if(_.ok&&(D(h,0),D(f,u)),!_.ok)throw new Error(`Session result request failed (${_.status})`);const M=await _.json(),P=Array.isArray(M)?M:[];return P.length>0&&R(o,P),P}catch(_){return _ instanceof TypeError&&_.message.includes("fetch")?console.error(`✗ Network error for session ${e}:`,_.message):console.error(`✗ Failed to fetch session results for ${e}:`,_),[]}}async function v(){D(N,!0),D(U,null),D(n,null);const e=g(x);if(e){console.log("Using cached race sessions"),D(A,e,!0),D(n,"cached"),D(N,!1);return}try{const r=await fetch(a);if(!r.ok)throw new Error(`Sessions request failed (${r.status})`);const o=await r.json();if(!Array.isArray(o))throw new Error("Unexpected sessions response format");const C=[];for(let _=0;_<o.length;_++){const M=o[_],P=`${m}${M.session_key}`,se=g(P);if(se)C.push({...M,results:se}),console.log(`✓ [${_+1}/${o.length}] Session ${M.session_key} from cache`),_<o.length-1&&await E(100);else{_>0&&await E(i(f)),console.log(`→ [${_+1}/${o.length}] Fetching session ${M.session_key} (delay: ${i(f)}ms)...`);const G=await s(M.session_key);C.push({...M,results:G})}}R(x,C),D(A,C,!0),D(n,"fresh"),D(h,0),D(f,u)}catch(r){console.error("Error fetching race sessions:",r),D(U,r instanceof Error?r.message:"Unknown error fetching sessions",!0)}finally{D(N,!1)}}function T(e){if(!e)return null;const r=new Date(e);return Number.isNaN(r.getTime())?null:r.toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1})}Ya(()=>{i(A).length===0&&!i(N)&&(H(),v())});var j=fr(),ae=ie(j);ja(ae);var Y=b(ae,2),L=$(Y),K=$(L),ce=b($(K));{var re=e=>{var r=Ka(),o=$(r,!0);S(r),B(()=>{Va(r,1,`cache-status ${i(n)??""}`,"svelte-1uha8ag"),I(o,i(n)==="fresh"?"Fresh":"Cached")}),y(e,r)};Q(ce,e=>{i(n)&&e(re)})}S(K);var fe=b(K,2);{var we=e=>{var r=er(),o=$(r,!0);S(r),B(()=>I(o,i(U))),y(e,r)},Se=e=>{var r=Ne(),o=ie(r);{var C=M=>{var P=ar();y(M,P)},_=M=>{var P=Ne(),se=ie(P);{var G=te=>{var pe=rr();y(te,pe)},je=te=>{var pe=cr(),ye=ie(pe),ke=$(ye),Ke=b(ke);{var ea=ue=>{var q=sr(),ne=b(ie(q),2),ve=$(ne);Ja(3),S(ne),B(he=>I(ve,`Data cached for ${he??""} minutes. `),[()=>Math.round(F/1e3/60)]),y(ue,q)};Q(Ke,ue=>{ue(ea)})}S(ye);var aa=b(ye,2);Xe(aa,17,()=>i(A),Pe,(ue,q)=>{var ne=ir(),ve=$(ne),he=$(ve),ra=$(he,!0);S(he);var sa=b(he,2);{var ta=X=>{var V=tr(),Te=$(V,!0);S(V),B(k=>I(Te,k),[()=>T(i(q).date_start)]),y(X,V)};Q(sa,X=>{T(i(q).date_start)&&X(ta)})}S(ve);var $e=b(ve,2),xe=$($e),na=$(xe,!0);S(xe);var Oe=b(xe,2),oa=$(Oe);S(Oe),S($e);var la=b($e,2);{var ia=X=>{var V=or();Xe(V,21,()=>i(q).results,Pe,(Te,k)=>{var Ce=nr(),Ae=$(Ce),fa=$(Ae);S(Ae);var Re=b(Ae,2),ua=$(Re,!0);S(Re);var Me=b(Re,2),va=$(Me,!0);S(Me);var Ue=b(Me,2),We=$(Ue);{var ha=J=>{var ee=me();B(()=>I(ee,`Time: ${i(k).time??""}`)),y(J,ee)},_a=J=>{var ee=Ne(),ma=ie(ee);{var ga=oe=>{var _e=me();B(()=>I(_e,`Status: ${i(k).status??""}`)),y(oe,_e)},Ea=oe=>{var _e=me();B(()=>I(_e,`Laps: ${i(k).laps??"—"??""}`)),y(oe,_e)};Q(ma,oe=>{i(k).status?oe(ga):oe(Ea,!1)},!0)}y(J,ee)};Q(We,J=>{i(k).time?J(ha):J(_a,!1)})}var da=b(We,2);{var pa=J=>{var ee=me();B(()=>I(ee,`• ${i(k).points??""} pts`)),y(J,ee)};Q(da,J=>{typeof i(k).points=="number"&&J(pa)})}S(Ue),S(Ce),B(()=>{I(fa,`P${i(k).position??"—"??""}`),I(ua,i(k).full_name??`Driver ${i(k).driver_number??"—"}`),I(va,i(k).team_name??"Team unavailable")}),y(Te,Ce)}),S(V),y(X,V)},ca=X=>{var V=lr();y(X,V)};Q(la,X=>{i(q).results.length>0?X(ia):X(ca,!1)})}S(ne),B(()=>{I(ra,i(q).meeting_name??i(q).circuit_short_name??`Session ${i(q).session_key}`),I(na,i(q).country_name??"Unknown location"),I(oa,`Session key: ${i(q).session_key??""}`)}),y(ue,ne)}),B(()=>I(ke,`Total race sessions found: ${i(A).length??""} `)),y(te,pe)};Q(se,te=>{i(A).length===0?te(G):te(je,!1)},!0)}y(M,P)};Q(o,M=>{i(N)&&i(A).length===0?M(C):M(_,!1)},!0)}y(e,r)};Q(fe,e=>{i(U)?e(we):e(Se,!1)})}S(L),S(Y),y(l,j),Pa()}export{pr as component};
